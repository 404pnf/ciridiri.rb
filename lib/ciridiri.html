<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>ciridiri.rb</title>
  <link rel="stylesheet" href="http://vast.github.com/rokko/assets/v0.1.2/docco.css" />
         <link rel="stylesheet" href="http://vast.github.com/rokko/assets/v0.1.2/highlight.css" />
  <script src="http://vast.github.com/rokko/assets/v0.1.2/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</head>
<body>
<div id="container">
  <div id="background"></div>
  <div id="jump_to">
    Jump To &hellip;
    <div id="jump_wrapper">
      <div id="jump_page">
          <a class="source" href="../index.html">index</a>
          <a class="source" href="./ciridiri.html">ciridiri.rb</a>
          <a class="source" href="ciridiri/extensions.html">extensions.rb</a>
          <a class="source" href="ciridiri/finders.html">finders.rb</a>
          <a class="source" href="ciridiri/page.html">page.rb</a>
          <a class="source" href="ciridiri/paths.html">paths.rb</a>
      </div>
    </div>
  </div>
  <table cellspacing="0" cellpadding="0">
  <thead>
    <tr>
      <th class="docs"><h1>ciridiri.rb</h1></th>
      <th class="code"></th>
    </tr>
  </thead>
  <tbody>
    <tr id="section-1">
      <td class="docs">
        <div class="pilwrap">
          <a class="pilcrow" href="#section-1">&#182;</a>
        </div>
        

      </td>
      <td class="code">
        <pre class="ruby"><code>require 'rubygems'
require 'sinatra/base'

$:.unshift(File.dirname(__FILE__))
require 'ciridiri/page'

class Ciridiri::Application &lt; Sinatra::Base
  include Ciridiri
  configure do
    set :app_file, __FILE__
    set :root, File.expand_path('..', File.dirname(__FILE__))
    enable :static
    enable :logging if development?

    Page.caching = false if development? || test?
    Page.content_dir = File.join(self.root, &quot;pages&quot;, self.environment.to_s)
  end

  helpers do
    include Rack::Utils
    alias_method :h, :escape_html
  end

  get '/' do
    redirect '/index.html'
  end

  get '*.html' do
    uri = params[:splat].first
    if @page = Page.find_by_uri(uri)
      erb :show
    else
      redirect &quot;#{uri}.html.e&quot;
    end
  end

  get '*.html.e' do
    @page = Page.find_by_uri_or_empty(params[:splat].first)
    erb :edit
  end

  post '*.html' do
    @page = Page.find_by_uri_or_empty(params[:splat].first)
    @page.contents = params[:contents]
    @page.save
    redirect &quot;#{@page.uri}.html&quot;
  end
end</code></pre>
      </td>
    </tr>
  </tbody>
  </table>
</div>
</body>
</html>
